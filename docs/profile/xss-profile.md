# プロフィール表示機能のXSS

## 脆弱性の説明
プロフィールのニックネーム表示で、ユーザー入力を適切にエスケープせずに表示しているため、クロスサイトスクリプティング（XSS）が可能です。

## 影響範囲
- 悪意のあるスクリプトの実行
- ユーザーセッションの盗取
- 不正な操作の実行

## 攻撃方法と手順

### 1. 基本的なXSS攻撃

1. アプリケーションにログインします
2. プロフィール更新ページにアクセスします
3. ニックネームフィールドに以下のXSSペイロードを入力します：
   ```html
   <img src=x onerror="alert(2)">
   ```
4. 更新ボタンをクリックします
5. プロフィールページにアクセスすると、アラートダイアログが表示されます

※もし、画面リロードしてもアラートダイアログが表示されない場合は、別タブで開いてみてください。

### 2. クッキー盗取攻撃

1. アプリケーションにログインします
2. プロフィール更新ページにアクセスします
3. ニックネームフィールドに以下のXSSペイロードを入力します：
   ```html
   <svg onload=alert(document.cookie)>
   ```
4. 更新ボタンをクリックします
5. 画面リロードすると、アラートダイアログが表示されます

※もし、画面リロードしてもアラートダイアログが表示されない場合は、別タブで開いてみてください。

このペイロードは、ユーザーのクッキーやローカルストレージに保存されたトークンを表示させるだけです。
もう少し悪用しようと思うと攻撃者のサーバーに送信することも可能です。
実際の攻撃では、攻撃者が制御するサーバーにユーザーのTokenなどのパラメータを付加して送信されます。

## 対策方法
### 1. エスケープ処理の実施
```javascript
// ユーティリティ関数の作成
function escapeHtml(text) {
  return text
    .replace(/&/g, "&amp;")
    .replace(/</g, "&lt;")
    .replace(/>/g, "&gt;")
    .replace(/"/g, "&quot;")
    .replace(/'/g, "&#039;");
}

// コンポーネントでの使用
export default {
  computed: {
    safeNickname() {
      return escapeHtml(this.user.nickname);
    }
  }
}
```

### 2. v-textディレクティブの使用
```vue
<!-- 修正前（脆弱なコード） -->
<template>
  <div v-html="authStore.user?.nickname"></div>
</template>

<!-- 修正後（安全なコード） -->
<template>
  <div v-text="authStore.user?.nickname"></div>
</template>
```
