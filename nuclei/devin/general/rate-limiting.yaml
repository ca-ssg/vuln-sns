id: vuln-sns-general-rate-limiting

info:
  name: vuln-sns General Rate Limiting
  author: devin
  severity: medium
  description: Testing for rate limiting across all endpoints
  classification:
    cvss-metrics: CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:N/I:N/A:L
    cvss-score: 5.3
    cwe-id: CWE-770
  metadata:
    max-request: 6
  tags: rate-limiting,general,vuln-sns

http:
  - method: GET
    path:
      - "{{BaseURL}}/api/health"
    
    attack: clusterbomb
    payloads:
      request: ["1", "2", "3", "4", "5", "6", "7", "8", "9", "10"]
    
    matchers-condition: and
    matchers:
      - type: status
        status:
          - 200
      
      - type: dsl
        dsl:
          - '!contains(tolower(header), "x-ratelimit")'
          - '!contains(tolower(header), "retry-after")'
        condition: and

  - method: GET
    path:
      - "{{BaseURL}}/api/posts"
    
    attack: clusterbomb
    payloads:
      request: ["1", "2", "3", "4", "5"]
    
    matchers-condition: and
    matchers:
      - type: status
        status:
          - 200
      
      - type: dsl
        dsl:
          - '!contains(tolower(header), "x-ratelimit")'

  - method: GET
    path:
      - "{{BaseURL}}/api/search?tag=test"
    
    attack: clusterbomb
    payloads:
      request: ["1", "2", "3", "4", "5"]
    
    matchers-condition: and
    matchers:
      - type: status
        status:
          - 200

  - method: POST
    path:
      - "{{BaseURL}}/api/login"
    
    headers:
      Content-Type: application/json
    
    body: |
      {
        "user_id": "test",
        "password": "test"
      }
    
    attack: clusterbomb
    payloads:
      request: ["1", "2", "3"]
    
    matchers-condition: and
    matchers:
      - type: status
        status:
          - 200
          - 401

  - method: GET
    path:
      - "{{BaseURL}}/api/profile"
    
    headers:
      Authorization: "Bearer alice_token"
    
    attack: clusterbomb
    payloads:
      request: ["1", "2", "3", "4", "5"]
    
    matchers-condition: and
    matchers:
      - type: status
        status:
          - 200

  - method: POST
    path:
      - "{{BaseURL}}/api/posts"
    
    headers:
      Content-Type: application/json
      Authorization: "Bearer alice_token"
    
    body: |
      {
        "content": "Rate limit test post"
      }
    
    attack: clusterbomb
    payloads:
      request: ["1", "2", "3"]
    
    matchers-condition: and
    matchers:
      - type: status
        status:
          - 201
          - 429
