id: vuln-sns-login-weak-session-id
info:
  name: Vuln SNS Login - Weak Session ID Generation
  author: claude
  severity: high
  description: |
    Tests for weak or predictable session ID/token generation.
    The application generates tokens in the format "userID_token",
    which is highly predictable and insecure.
  reference:
    - https://owasp.org/www-community/vulnerabilities/Session_Prediction
  tags: vuln-sns,session,weak-token,login

http:
  - raw:
      - |
        POST /api/login HTTP/1.1
        Host: {{Hostname}}
        Content-Type: application/json

        {"user_id":"alice","password":"alice"}

      - |
        POST /api/login HTTP/1.1
        Host: {{Hostname}}
        Content-Type: application/json

        {"user_id":"bob","password":"bob"}

      - |
        POST /api/login HTTP/1.1
        Host: {{Hostname}}
        Content-Type: application/json

        {"user_id":"charlie","password":"charlie"}

    matchers-condition: and
    matchers:
      - type: word
        words:
          - '"token":'
        part: body_1

      - type: regex
        regex:
          - '"token":\s*"[a-zA-Z0-9]+_token"'
        part: body_1

      - type: dsl
        dsl:
          - 'contains(body_1, "alice_token")'
          - 'contains(body_2, "bob_token")'
          - 'contains(body_3, "charlie_token")'
        condition: or
        name: predictable-tokens

    extractors:
      - type: regex
        name: weak_tokens
        regex:
          - '"token":\s*"([^"]+)"'
        part: body