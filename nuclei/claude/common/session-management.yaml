id: vuln-sns-common-session-management
info:
  name: Vuln SNS - Weak Session Management
  author: claude
  severity: high
  description: |
    Tests for weak session management practices.
  reference:
    - https://owasp.org/www-project-web-security-testing-guide/latest/4-Web_Application_Security_Testing/06-Session_Management_Testing/
  tags: vuln-sns,session,common

http:
  - raw:
      - |
        POST /api/login HTTP/1.1
        Host: {{Hostname}}
        Content-Type: application/json
        
        {"user_id":"alice","password":"alice"}
        
      - |
        POST /api/login HTTP/1.1
        Host: {{Hostname}}
        Content-Type: application/json
        
        {"user_id":"alice","password":"alice"}

    matchers-condition: or
    matchers:
      - type: word
        words:
          - "alice_token"
        part: body
        condition: and

      - type: dsl
        dsl:
          - 'body_1 == body_2'
        name: same-token-issued

    extractors:
      - type: regex
        name: tokens
        regex:
          - '"token":\s*"([^"]+)"'
        part: body